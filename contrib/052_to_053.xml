<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.3.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>

		<title lang="en">Invite A Friend</title>
		<description lang="en">Invite A Friend is an addition to phpBB3, that enables your users to advise their friends of your board. Each invitation sent per email is attached a key, which may (or not) be required to register and keeps track of successful registrations. Furthermore you are given the ability to limit the amount of invitations every user can send in several ways. Supports Ultimate Points and Cash Mod.</description>
		<author-notes lang="en">Support and bug reports: <![CDATA[http://www.phpbb.com/community/viewtopic.php?f=70&t=1224005]]></author-notes>

		<author-group>
			<author>
				<realname></realname>
				<email>bycoja@web.de</email>
				<username>Bycoja</username>
				<homepage>http://bycoja.bplaced.net</homepage>
			</author>
		</author-group>

		<mod-version>0.5.3</mod-version>

		<installation>
			<level>easy</level>
			<time>720</time>
			<target-version>3.0.6</target-version>
		</installation>

		<history>
			<entry>
				<date>2009-11-24</date>
				<rev-version>0.5.3 [Beta]</rev-version>
				<changelog lang="en">
					<change>[Added] Ultimate Points support</change>
					<change>[Added] Identify invited users by e-mail address</change>
					<change>[Added] Several checks for unexpected cases</change>
					<change>[Changed] Improved key generation</change>
					<change>[Changed] Code cleanup</change>
					<change>[Changed] MOD description</change>
					<change>[Fixed] Broken CAPTCHAs</change>
					<change>[Fixed] Template system</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-05-20</date>
				<rev-version>0.5.2 [Beta]</rev-version>
				<changelog lang="en">
					<change>[Added] Add users, who enter a registration key, to the selected group</change>
					<change>[Changed] Create registration keys (even if keys are disabled) to identify friends</change>
					<change>[Changed] Removed constant 'REGISTER_KEY_DISABLED'</change>
					<change>[Fixed] Report #020: Messenger vars not parsed in PM</change>
					<change>[Fixed] Report #019: Missing language vars</change>
					<change>[Fixed] Report #018: E-mail already taken</change>
					<change>[Fixed] Report #016: CAPTCHA</change>
					<change>[Fixed] Report #016: function install(), messages</change>
					<change>[Fixed] Report #015: function install(), permissions</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-04-12</date>
				<rev-version>0.5.1 [Beta]</rev-version>
				<changelog lang="en">
					<change>[Added] Account activation</change>
					<change>[Added] Limitation: Topics</change>
					<change>[Added] Automatically create sql tables, install permissions, ...</change>
					<change>[Added] Automatically add messages referring to installed languages</change>
					<change>[Fixed] Report #013: COPPA Bug</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-04-08</date>
				<rev-version>0.5.0 [Beta]</rev-version>
				<changelog lang="en">
					<change>[Added] Compatibility with 'Advanced Points System'</change>
					<change>[Added] Many options (CAPTCHA, Limitation, ..)</change>
					<change>[Improved] Rewrote some code</change>
				</changelog>
			</entry>
			<entry>
				<date>2008-10-10</date>
				<rev-version>0.2.2 [Beta]</rev-version>
				<changelog lang="en">
					<change>[Added] Compatibility with 'Cash Mod'</change>
					<change>[Added] Highly improved log</change>
					<change>[Added] UCP Module</change>
					<change>[Fixed] Report #009: [phpBB Debug] Undefined variable: new_user_row</change>
					<change>[Fixed] Report #008: [phpBB Debug] Undefined variable: invitation_data</change>
				</changelog>
			</entry>
			<entry>
				<date>2008-10-06</date>
				<rev-version>0.2.1 [Beta]</rev-version>
				<changelog lang="en">
					<change>[Added] Optional registration-key</change>
					<change>[Added] Prohibit multiple registrations</change>
					<change>[Fixed] Report #007: Empty {USERNAME}</change>
					<change>[Fixed] Report #006: Missing var</change>
				</changelog>
			</entry>
			<entry>
				<date>2008-10-05</date>
				<rev-version>0.2.0 [Beta]</rev-version>
				<changelog lang="en">
					<change>[Added] Confirmation e-mail</change>
					<change>[Added] New settings</change>
					<change>[Added] Log</change>
					<change>[Fixed] Report #005: Invite yourself</change>
					<change>[Fixed] Report #004: phpBB Debug</change>
					<change>[Fixed] Report #003: ACP: Edit Mail</change>
					<change>[Fixed] Report #002: 'Invite a friend' shown in navigation</change>
					<change>[Fixed] Report #001: Registration-keys</change>
				</changelog>
			</entry>
		</history>

		<link-group>
			<link type="parent" href="../install.xml" lang="en">install.xml</link>
		</link-group>
	</header>

	<action-group>
		<sql><![CDATA[--
-- Change the prefix if required!
--

DROP TABLE `phpbb_invite_message`;

--
-- Change the prefix if required!
--

UPDATE `phpbb_invite_config` SET `config_name` = 'enable_ultimate_points' WHERE `config_name` = 'enable_points';
UPDATE `phpbb_invite_config` SET `config_name` = 'ultimate_points_invite' WHERE `config_name` = 'points_invite';
UPDATE `phpbb_invite_config` SET `config_name` = 'ultimate_points_register' WHERE `config_name` = 'points_register';

--
-- Change the prefix if required!
--

UPDATE `phpbb_config` SET `config_value` = '0.5.3' WHERE `config_name` = 'invite_version';]]></sql>

		<copy>
			<file from="/root/includes/acp/info/acp_invite.php" to="/includes/acp/info/acp_invite.php" />
			<file from="/root/includes/acp/acp_invite.php" to="/includes/acp/acp_invite.php" />
			<file from="/root/adm/style/acp_invite.html" to="/adm/style/acp_invite.html" />
			<file from="/root/adm/style/acp_invite_log.html" to="/adm/style/acp_invite_log.html" />
			<file from="/root/includes/functions_invite.php" to="/includes/functions_invite.php" />
			<file from="/root/includes/ucp/info/ucp_invite.php" to="/includes/ucp/info/ucp_invite.php" />
			<file from="/root/includes/ucp/ucp_invite.php" to="/includes/ucp/ucp_invite.php" />
			<file from="/root/language/de/mods/info_acp_invite.php" to="/language/de/mods/info_acp_invite.php" />
			<file from="/root/language/de/mods/info_ucp_invite.php" to="/language/de/mods/info_ucp_invite.php" />
			<file from="/root/language/de/email/invite_invite.txt" to="/language/de/email/invite_invite.txt" />
			<file from="/root/language/de/email/invite_confirm.txt" to="/language/de/email/invite_confirm.txt" />
			<file from="/root/language/en/mods/info_acp_invite.php" to="/language/en/mods/info_acp_invite.php" />
			<file from="/root/language/en/mods/info_ucp_invite.php" to="/language/en/mods/info_ucp_invite.php" />
			<file from="/root/language/en/email/invite_invite.txt" to="/language/en/email/invite_invite.txt" />
			<file from="/root/language/en/email/invite_confirm.txt" to="/language/en/email/invite_confirm.txt" />
			<file from="/root/styles/prosilver/template/ucp_invite_invite.html" to="/styles/prosilver/template/ucp_invite_invite.html" />
		</copy>

		<open src="includes/ucp/ucp_register.php">
			<edit>
				<find><![CDATA[			if ($invite->config['enable'])]]></find>
				<action type="replace-with"><![CDATA[			if ($invite->config['enable'] && !($invite->email_is_invited($data['email'])))]]></action>
			</edit>

			<edit>
				<find><![CDATA[			'S_UCP_ACTION'		=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'mode=register'),]]></find>
				<action type="replace-with"><![CDATA[			'S_UCP_ACTION'		=> append_sid("{$phpbb_root_path}ucp.$phpEx", $url_key . 'mode=register'),]]></action>
			</edit>
		</open>

		<diy-instructions lang="en">Purge the cache!</diy-instructions>
	</action-group>
</mod>